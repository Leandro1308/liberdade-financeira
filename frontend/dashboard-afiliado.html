<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Área de Afiliado • Liberdade Financeira</title>

  <style>
    :root{
      --bg:#070b12;
      --bg2:#0f1c2e;
      --card:#0f1726;
      --line:rgba(255,255,255,.08);
      --text:#e7eefc;
      --muted:#aab3c5;
      --accent:#24ff8a;
      --accent2:#4ef1c3;
      --shadow:0 14px 30px rgba(0,0,0,.35);
      --radius:18px;
      --sidebar:260px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: linear-gradient(180deg, var(--bg), var(--bg2));
      display:flex;
    }

    aside{
      width:var(--sidebar);
      background: rgba(0,0,0,.35);
      border-right:1px solid var(--line);
      padding:20px;
      display:flex;
      flex-direction:column;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      font-size:18px;
      margin-bottom:18px;
    }

    .logo{
      width:34px;
      height:34px;
      border-radius:12px;
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(78,241,195,.9), transparent 60%),
        radial-gradient(14px 14px at 70% 70%, rgba(36,255,138,.9), transparent 60%);
      border:1px solid var(--line);
    }

    nav a{
      display:block;
      padding:12px 14px;
      border-radius:14px;
      color:var(--text);
      text-decoration:none;
      font-weight:700;
      margin-bottom:6px;
      border:1px solid transparent;
    }

    nav a.active,
    nav a:hover{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(78,241,195,.35);
    }

    main{
      flex:1;
      padding:26px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:22px;
      margin-bottom:18px;
    }

    h1{
      margin:0 0 8px;
      font-size:24px;
    }

    p{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.6;
    }

    .stats{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
      margin-top:16px;
    }

    .stat{
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      background: rgba(0,0,0,.25);
    }

    .stat strong{
      font-size:22px;
      display:block;
      margin-bottom:4px;
      color:var(--accent);
    }

    .linkbox{
      margin-top:14px;
      padding:14px;
      border-radius:14px;
      border:1px dashed rgba(78,241,195,.45);
      background: rgba(0,0,0,.25);
      font-size:13px;
      word-break:break-all;
    }

    .btnRow{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(36,255,138,.45);
      background: linear-gradient(180deg, rgba(36,255,138,.18), rgba(36,255,138,.06));
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      font-size:13px;
    }

    .btn:hover{ border-color: rgba(36,255,138,.70); }

    .logout{
      margin-top:auto;
      font-size:13px;
      color:var(--muted);
      text-decoration:none;
      text-align:center;
    }
    .logout:hover{ text-decoration:underline; }

    @media (max-width: 900px){
      aside{ display:none; }
      body{ flex-direction:column; }
    }
  </style>
</head>

<body>

  <aside>
    <div class="brand">
      <div class="logo"></div>
      Liberdade Financeira
    </div>

    <nav>
      <a href="./dashboard.html">Visão geral</a>
      <a href="./dashboard-conteudo.html">Conteúdo</a>
      <a href="./dashboard-afiliado.html" class="active">Área de afiliado</a>
      <a href="./dashboard-conta.html">Minha conta</a>
    </nav>

    <a id="logoutLink" class="logout" href="./index.html">Sair</a>
  </aside>

  <main>
    <div class="card">
      <h1>Área de afiliado</h1>
      <p>
        Compartilhe seu link de indicação e acompanhe suas indicações e resultados.
      </p>

      <div class="stats">
        <div class="stat">
          <strong id="totalRef">—</strong>
          Indicações totais
        </div>
        <div class="stat">
          <strong id="activeSubs">—</strong>
          Assinaturas ativas
        </div>
        <div class="stat">
          <strong id="earnings">—</strong>
          Ganhos (em breve)
        </div>
      </div>
    </div>

    <div class="card">
      <h1>Seu link de afiliado</h1>
      <div class="linkbox" id="refLink">
        carregando…
      </div>

      <div class="btnRow">
        <button class="btn" id="btnCopy" type="button">Copiar link</button>
      </div>

      <p class="muted" style="margin-top:12px;">
        Código: <strong id="refCode">—</strong>
      </p>
    </div>
  </main>

  <script src="./app.js"></script>
  <script>
    if (!LF.requireAuth()) {}
    LF.attachLogout("#logoutLink");

    async function loadAffiliate(){
      const data = await LF.apiFetch("/api/afiliados/me");

      LF.setText("totalRef", data?.totalReferrals ?? 0);
      LF.setText("activeSubs", data?.activeSubscriptions ?? 0);
      LF.setText("earnings", data?.earnings ?? "—");
      LF.setText("refCode", data?.code ?? "—");

      const link = data?.referralLink || "—";
      LF.setText("refLink", link);

      document.getElementById("btnCopy").onclick = async () => {
        try {
          await navigator.clipboard.writeText(link);
          alert("Link copiado!");
        } catch {
          alert("Não foi possível copiar automaticamente. Copie manualmente.");
        }
      };
    }

    loadAffiliate().catch(() => {
      LF.setText("refLink", "erro ao carregar");
    });
  </script>
</body>
</html>
