<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dashboard ‚Ä¢ Liberdade Financeira</title>
  <link rel="stylesheet" href="/assets/app.css"/>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="card sidecard">
        <div class="brand"><span class="dot"></span> Liberdade Financeira</div>
        <div class="muted small" id="who" style="margin-top:8px;">Carregando‚Ä¶</div>
      </div>

      <div class="nav">
        <a class="active" href="/dashboard.html">Vis√£o geral <span class="muted small">‚Üí</span></a>
        <a href="/dashboard-conteudo.html">Conte√∫do <span class="muted small">‚Üí</span></a>
        <a href="/dashboard-afiliado.html">Afiliado <span class="muted small">‚Üí</span></a>
        <a href="/dashboard-conta.html">Minha conta <span class="muted small">‚Üí</span></a>
        <a href="/index.html">Sair (p√∫blico) <span class="muted small">‚Üí</span></a>
      </div>

      <div style="height:12px"></div>
      <button id="logout" class="btn ghost" style="width:100%;">Encerrar sess√£o</button>
    </aside>

    <main class="main">
      <div class="card section">
        <h2 style="margin:0 0 6px;">Vis√£o geral</h2>
        <p class="muted" style="margin:0;">
          Aqui √© sua √°rea do aluno. Conte√∫do, progresso e afiliado ficam no menu.
        </p>
      </div>

      <div style="height:14px"></div>

      <div class="grid" style="grid-template-columns: 1fr 1fr;">
        <div class="card section">
          <div class="badge">‚úÖ Status</div>
          <div id="sub" class="muted" style="margin-top:10px;">Carregando‚Ä¶</div>
        </div>

        <div class="card section">
          <div class="badge">üìå Pr√≥ximo passo</div>
          <p class="muted small" style="margin-top:10px;">
            V√° em <b>Conte√∫do</b> para ver os m√≥dulos liberados. Em <b>Afiliado</b> voc√™ copia seu link.
          </p>
        </div>
      </div>

      <div id="toast" class="toast"><div class="msg"></div></div>
    </main>
  </div>

  <script type="module">
    import { clearToken, me, requireLogged, requireActive } from "/assets/auth.js";
    import { toast } from "/assets/ui.js";

    const token = requireLogged();

    document.getElementById("logout").addEventListener("click", () => {
      clearToken();
      location.href = "/login.html";
    });

    async function init(){
      try{
        const data = await me();
        const user = data.user;
        document.getElementById("who").textContent = `${user.name} ‚Ä¢ ${user.email}`;
        if (!requireActive(user.subscription)) return;

        const end = user.subscription.currentPeriodEnd
          ? new Date(user.subscription.currentPeriodEnd).toLocaleString("pt-BR")
          : "-";

        document.getElementById("sub").innerHTML = `
          <div class="badge">Plano: <b>${user.subscription.plan}</b></div>
          <div class="muted small" style="margin-top:8px;">
            Status: <b>${user.subscription.status}</b><br/>
            Renova√ß√£o autom√°tica: <b>${user.subscription.renovacaoAutomatica ? "SIM" : "N√ÉO"}</b><br/>
            Vencimento: <b>${end}</b>
          </div>
        `;
      }catch(e){
        toast("Sess√£o inv√°lida. Fa√ßa login novamente.", "error");
        clearToken();
        setTimeout(()=> location.href="/login.html", 800);
      }
    }

    init();
  </script>
</body>
</html>
