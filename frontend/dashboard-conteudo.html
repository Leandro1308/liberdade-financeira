<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ConteÃºdo â€¢ Liberdade Financeira</title>
  <link rel="stylesheet" href="/assets/app.css"/>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="card sidecard">
        <div class="brand"><span class="dot"></span> Liberdade Financeira</div>
        <div class="muted small" id="who" style="margin-top:8px;">Carregandoâ€¦</div>
      </div>

      <div class="nav">
        <a href="/dashboard.html">VisÃ£o geral <span class="muted small">â†’</span></a>
        <a class="active" href="/dashboard-conteudo.html">ConteÃºdo <span class="muted small">â†’</span></a>
        <a href="/dashboard-afiliado.html">Afiliado <span class="muted small">â†’</span></a>
        <a href="/dashboard-conta.html">Minha conta <span class="muted small">â†’</span></a>
        <a href="/index.html">Sair (pÃºblico) <span class="muted small">â†’</span></a>
      </div>

      <div style="height:12px"></div>
      <button id="logout" class="btn ghost" style="width:100%;">Encerrar sessÃ£o</button>
    </aside>

    <main class="main">
      <div class="card section">
        <h2 style="margin:0 0 6px;">ConteÃºdo</h2>
        <p class="muted" style="margin:0;">MÃ³dulos liberados pela sua assinatura ativa.</p>
      </div>

      <div style="height:14px"></div>

      <div id="list" class="grid" style="grid-template-columns: 1fr 1fr;"></div>

      <div id="toast" class="toast"><div class="msg"></div></div>
    </main>
  </div>

  <script type="module">
    import { clearToken, me, requireLogged, requireActive, getToken } from "/assets/auth.js";
    import { api } from "/assets/api.js";
    import { toast } from "/assets/ui.js";

    requireLogged();

    document.getElementById("logout").addEventListener("click", () => {
      clearToken();
      location.href = "/login.html";
    });

    async function init(){
      try{
        const data = await me();
        const user = data.user;
        document.getElementById("who").textContent = `${user.name} â€¢ ${user.email}`;
        if (!requireActive(user.subscription)) return;

        const token = getToken();
        const content = await api("/api/content/modules", { token });
        const list = document.getElementById("list");
        list.innerHTML = "";

        for (const m of content.modules){
          const div = document.createElement("div");
          div.className = "card section";
          div.innerHTML = `
            <div class="badge">ðŸ“š ${m.title}</div>
            <p class="muted small" style="margin-top:10px;">Itens: <b>${m.items}</b></p>
            <button class="btn" style="margin-top:10px;">Abrir (em breve)</button>
          `;
          list.appendChild(div);
        }
      }catch(e){
        toast("Falha ao carregar conteÃºdo. FaÃ§a login novamente.", "error");
        clearToken();
        setTimeout(()=> location.href="/login.html", 900);
      }
    }

    init();
  </script>
</body>
</html>
