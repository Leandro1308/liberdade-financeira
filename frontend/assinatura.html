<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Assinatura • Liberdade Financeira</title>
  <link rel="stylesheet" href="/assets/app.css"/>
</head>
<body>
  <div class="container">
    <div class="card topbar">
      <div class="brand"><span class="dot"></span> Liberdade Financeira</div>
      <div style="display:flex; gap:10px;">
        <a class="badge" href="/index.html">Início</a>
        <a class="badge" href="/login.html">Entrar</a>
        <a class="badge" href="/dashboard.html">Dashboard</a>
      </div>
    </div>

    <div style="height:16px"></div>

    <div class="grid" style="grid-template-columns: 1fr 1fr;">
      <div class="card section">
        <h2 style="margin:0 0 8px;">Plano Mensal</h2>
        <p class="muted" style="margin:0 0 14px;">
          Acesso completo ao conteúdo + dashboard + área de afiliado.
        </p>
        <div class="badge">R$ — (pagamento entra depois)</div>

        <div style="height:14px"></div>

        <button id="mockActivate" class="btn primary">Ativar acesso (modo teste)</button>
        <p class="muted small" style="margin-top:10px;">
          Isso é apenas para validação do fluxo (sem cobrança). Quando integrar pagamento,
          este botão será removido e a ativação virá do webhook do gateway.
        </p>
      </div>

      <div class="card section">
        <h2 style="margin:0 0 8px;">Status da sua conta</h2>
        <div id="status" class="muted">Carregando…</div>
        <div style="height:12px"></div>

        <a class="btn" href="/dashboard.html">Ir para dashboard</a>
      </div>
    </div>

    <div id="toast" class="toast"><div class="msg"></div></div>
  </div>

  <script type="module">
    import { me, activateMock, requireLogged } from "/assets/auth.js";
    import { toast } from "/assets/ui.js";

    const token = requireLogged();
    const status = document.getElementById("status");

    async function load(){
      try{
        const data = await me();
        const sub = data?.user?.subscription;
        status.innerHTML = `
          <div class="badge">Status: <b>${sub?.status || "inactive"}</b></div>
          <div class="muted small" style="margin-top:8px;">
            Renovação automática: <b>${sub?.renovacaoAutomatica ? "SIM" : "NÃO"}</b><br/>
            Vencimento: <b>${sub?.currentPeriodEnd ? new Date(sub.currentPeriodEnd).toLocaleString("pt-BR") : "-"}</b>
          </div>
        `;
      }catch(e){
        status.textContent = "Falha ao carregar status.";
      }
    }

    document.getElementById("mockActivate").addEventListener("click", async () => {
      try{
        await activateMock();
        toast("Acesso ativado (modo teste).");
        await load();
      }catch(err){
        toast(err.message || "Falha ao ativar", "error");
      }
    });

    load();
  </script>
</body>
</html>
